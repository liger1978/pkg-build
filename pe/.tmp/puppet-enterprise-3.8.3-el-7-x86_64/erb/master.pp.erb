<%# Answer Variable => Ruby Variable Translation -%>
<%
  @master_certname  = ENV["q_puppetmaster_certname"]
  @console_certname = ENV["q_puppetmaster_enterpriseconsole_certname"]
  @install_classifier  = ENV["q_puppetmaster_external_node_terminus"] == "n" || ENV["IS_UPGRADE"] != "y"
-%>
class { puppet_enterprise::profile::master:
    certname                => '<%= @master_certname -%>',
    console_server_certname => '<%= @console_certname -%>',
    <% if @install_classifier -%>
    classifier_host         => '<%= @console_certname -%>',
    <% end -%>
    <% if ENV['t_puppetserver_java_args'] -%>
    java_args               => <%= Hash[*ENV['t_puppetserver_java_args'].split.to_a] -%>,
    <% end -%>
}

class { puppet_enterprise::profile::certificate_authority: }

class { puppet_enterprise::profile::amq::broker: }
class { puppet_enterprise::profile::mcollective::agent: }
class { puppet_enterprise::profile::mcollective::peadmin: }

class { puppet_enterprise::profile::agent: }
